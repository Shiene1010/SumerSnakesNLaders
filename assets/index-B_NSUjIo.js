(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function s(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=s(t);fetch(t.href,i)}})();class o{constructor(){this.reset()}reset(){this.gold=10,this.stamina=10,this.karma=0,this.currentNode="start",this.gameOver=!1}loadTheme(e){this.themeData=e,this.reset(),e.initialStats&&(this.gold=e.initialStats.gold??10,this.stamina=e.initialStats.stamina??10,this.karma=e.initialStats.karma??0)}applyEffects(e){e&&(e.gold&&(this.gold+=e.gold),e.stamina&&(this.stamina+=e.stamina),e.karma&&(this.karma+=e.karma))}makeChoice(e){const n=this.themeData.scenarios[this.currentNode].options[e];if(n.requirement){const{stat:i,min:r}=n.requirement;if(this[i]<r)return{success:!1,message:`Requirement not met: ${i.toUpperCase()} must be at least ${r}.`}}if(this.applyEffects(n.effects),this.currentNode=n.next,this.stamina<=0)return this.gameOver=!0,{success:!0,event:"exhaustion"};const t=this.themeData.scenarios[this.currentNode];return!t.options||t.options.length===0?(this.gameOver=!0,{success:!0,event:"finish"}):{success:!0}}getCurrentNode(){return this.themeData.scenarios[this.currentNode]}}class c{constructor(){this.engine=new o,this.views={gallery:document.getElementById("theme-gallery"),game:document.getElementById("game-screen")},this.narrativeEl=document.getElementById("narrative-text"),this.choicesEl=document.getElementById("choices-container"),this.stats={gold:document.getElementById("gold-val"),stamina:document.getElementById("stamina-val"),karma:document.getElementById("karma-val")}}async selectTheme(e){try{const s=await fetch(`data/${e}.json`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();this.engine.loadTheme(n),this.showView("game"),this.updateUI()}catch(s){console.error("Failed to load theme:",s),alert("Error loading theme data.")}}showView(e){Object.keys(this.views).forEach(s=>{this.views[s].classList.remove("active")}),this.views[e].classList.add("active")}updateUI(){const e=this.engine.getCurrentNode();if(this.stats.gold.textContent=this.engine.gold,this.stats.stamina.textContent=this.engine.stamina,this.stats.karma.textContent=this.engine.karma,this.narrativeEl.innerHTML=`<p>${e.description}</p>`,this.narrativeEl.className="fade-in-text",this.choicesEl.innerHTML="",this.engine.gameOver){const s=document.createElement("button");s.className="choice-btn primary",s.textContent="Return to Menu",s.onclick=()=>this.quitToMenu(),this.choicesEl.appendChild(s)}else e.options.forEach((s,n)=>{const t=document.createElement("button");t.className="choice-btn",t.textContent=s.text,t.onclick=()=>this.handleChoice(n),this.choicesEl.appendChild(t)})}handleChoice(e){const s=this.engine.makeChoice(e);s.success?this.updateUI():alert(s.message)}quitToMenu(){this.showView("gallery")}}window.game=new c;
